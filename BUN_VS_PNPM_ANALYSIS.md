# Bun vs pnpm åˆ‡æ¢åˆ†æ

## ğŸ“Š å½“å‰çŠ¶æ€

### ä½ çš„é¡¹ç›®é…ç½®
- **åŒ…ç®¡ç†å™¨**: pnpm (å½“å‰ä½¿ç”¨)
- **å¼€å‘æœåŠ¡å™¨**: Vite (`pnpm dev`)
- **ç”Ÿäº§æœåŠ¡å™¨**: Bun (`bun run server.ts`)
- **Bun ç‰ˆæœ¬**: 1.3.5 (å·²å®‰è£…)
- **é¡¹ç›®ç±»å‹**: TanStack Start (React 19 + SSR)

### æ··åˆä½¿ç”¨æƒ…å†µ
```json
{
  "scripts": {
    "dev": "vite dev --port 3000",           // ä½¿ç”¨ Vite
    "build": "vite build",                   // ä½¿ç”¨ Vite
    "start:win": "bun run server.ts",        // ä½¿ç”¨ Bun
    "check": "pnpm format && pnpm lint..."   // ä½¿ç”¨ pnpm
  }
}
```

**ç°çŠ¶**: ä½ å·²ç»åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ Bun ä½œä¸ºè¿è¡Œæ—¶ï¼Œä½†ä¾èµ–ç®¡ç†ä»ç”¨ pnpm

---

## ğŸ¤” æ˜¯å¦æœ‰å¿…è¦åˆ‡æ¢åˆ° Bunï¼Ÿ

### âŒ **å»ºè®®ä¸åˆ‡æ¢** - ç†ç”±å¦‚ä¸‹

#### 1. **å½“å‰æ–¹æ¡ˆå·²ç»å¾ˆå¥½**

ä½ çš„é¡¹ç›®é‡‡ç”¨äº†**æœ€ä½³å®è·µ**çš„æ··åˆæ–¹æ¡ˆï¼š

âœ… **pnpm ç®¡ç†ä¾èµ–** - ä¼˜åŠ¿ï¼š
- ç£ç›˜ç©ºé—´æ•ˆç‡æé«˜ï¼ˆç¡¬é“¾æ¥æœºåˆ¶ï¼‰
- ä¸¥æ ¼çš„ä¾èµ–ç®¡ç†ï¼ˆé˜²æ­¢å¹½çµä¾èµ–ï¼‰
- æˆç†Ÿç¨³å®šï¼Œç¤¾åŒºå¹¿æ³›ä½¿ç”¨
- ä¸æ‰€æœ‰ npm åŒ… 100% å…¼å®¹

âœ… **Bun ä½œä¸ºç”Ÿäº§è¿è¡Œæ—¶** - ä¼˜åŠ¿ï¼š
- æå¿«çš„å¯åŠ¨é€Ÿåº¦
- å†…ç½® HTTP æœåŠ¡å™¨æ€§èƒ½ä¼˜å¼‚
- åŸç”Ÿæ”¯æŒ TypeScript
- ä½ çš„ `server.ts` å·²ç»å……åˆ†åˆ©ç”¨äº† Bun çš„ç‰¹æ€§

#### 2. **Bun ä½œä¸ºåŒ…ç®¡ç†å™¨çš„é—®é¢˜**

| æ–¹é¢ | pnpm | Bun |
|------|------|-----|
| **ç¨³å®šæ€§** | â­â­â­â­â­ éå¸¸æˆç†Ÿ | â­â­â­ ä»åœ¨å¿«é€Ÿè¿­ä»£ |
| **å…¼å®¹æ€§** | â­â­â­â­â­ 100% npm å…¼å®¹ | â­â­â­â­ å¶å°”æœ‰å…¼å®¹æ€§é—®é¢˜ |
| **ç£ç›˜æ•ˆç‡** | â­â­â­â­â­ ç¡¬é“¾æ¥æœºåˆ¶ | â­â­â­â­ å…¨å±€ç¼“å­˜ |
| **å®‰è£…é€Ÿåº¦** | â­â­â­â­ å¾ˆå¿« | â­â­â­â­â­ æœ€å¿« |
| **lockfile** | `pnpm-lock.yaml` (æˆç†Ÿ) | `bun.lockb` (äºŒè¿›åˆ¶) |
| **CI/CD æ”¯æŒ** | â­â­â­â­â­ å¹¿æ³›æ”¯æŒ | â­â­â­ é€æ­¥æ”¯æŒ |

#### 3. **å®é™…æ€§èƒ½å·®å¼‚ä¸å¤§**

**å®‰è£…é€Ÿåº¦å¯¹æ¯”**ï¼ˆä½ çš„é¡¹ç›®è§„æ¨¡ï¼‰:
```bash
# pnpm install
æ—¶é—´: ~15-30ç§’ (é¦–æ¬¡), ~5-10ç§’ (æœ‰ç¼“å­˜)

# bun install
æ—¶é—´: ~8-15ç§’ (é¦–æ¬¡), ~3-5ç§’ (æœ‰ç¼“å­˜)
```

**èŠ‚çœæ—¶é—´**: æ¯æ¬¡å®‰è£…çº¦ 5-10 ç§’
**æ˜¯å¦å€¼å¾—**: âŒ ä¸å€¼å¾—å†’å…¼å®¹æ€§é£é™©

#### 4. **æ½œåœ¨é£é™©**

åˆ‡æ¢åˆ° Bun å¯èƒ½é‡åˆ°çš„é—®é¢˜ï¼š

```bash
# 1. æŸäº›åŒ…å¯èƒ½æœ‰å…¼å®¹æ€§é—®é¢˜
# ä¾‹å¦‚ï¼šnative æ¨¡å—ã€postinstall è„šæœ¬

# 2. lockfile æ ¼å¼ä¸åŒ
# pnpm-lock.yaml (æ–‡æœ¬) vs bun.lockb (äºŒè¿›åˆ¶)
# å›¢é˜Ÿåä½œæ—¶å¯èƒ½æœ‰é—®é¢˜

# 3. CI/CD é…ç½®éœ€è¦ä¿®æ”¹
# GitHub Actions, Vercel, Netlify ç­‰

# 4. å·¥å…·é“¾å…¼å®¹æ€§
# Husky, lint-staged ç­‰å¯èƒ½éœ€è¦è°ƒæ•´
```

---

## âœ… æ¨èæ–¹æ¡ˆï¼šä¿æŒå½“å‰æ··åˆä½¿ç”¨

### æœ€ä½³å®è·µé…ç½®

```json
{
  "scripts": {
    // å¼€å‘ç¯å¢ƒ - ä½¿ç”¨ Vite (æˆç†Ÿç¨³å®š)
    "dev": "vite dev --port 3000",
    
    // æ„å»º - ä½¿ç”¨ Vite (ä¼˜åŒ–æœ€å¥½)
    "build": "vite build",
    
    // ç”Ÿäº§è¿è¡Œ - ä½¿ç”¨ Bun (æ€§èƒ½æœ€ä½³)
    "start:win": "bun run server.ts",
    
    // ä¾èµ–ç®¡ç† - ä½¿ç”¨ pnpm (ç¨³å®šå¯é )
    "install": "pnpm install"
  }
}
```

### ä¸ºä»€ä¹ˆè¿™æ˜¯æœ€ä½³æ–¹æ¡ˆï¼Ÿ

1. **å¼€å‘ä½“éªŒ** âœ…
   - Vite HMR æå¿«
   - pnpm ä¾èµ–ç®¡ç†ç¨³å®š
   - å·¥å…·é“¾æˆç†Ÿå®Œå–„

2. **ç”Ÿäº§æ€§èƒ½** âœ…
   - Bun è¿è¡Œæ—¶æ€§èƒ½ä¼˜å¼‚
   - ä½ çš„ `server.ts` å·²ç»ä¼˜åŒ–å¾—å¾ˆå¥½
   - å……åˆ†åˆ©ç”¨ Bun çš„åŸç”Ÿç‰¹æ€§

3. **é£é™©æœ€å°** âœ…
   - ä¸éœ€è¦ä¿®æ”¹ç°æœ‰é…ç½®
   - ä¸ä¼šé‡åˆ°å…¼å®¹æ€§é—®é¢˜
   - CI/CD æ— éœ€æ”¹åŠ¨

---

## ğŸ¯ ä½•æ—¶è€ƒè™‘åˆ‡æ¢åˆ° Bunï¼Ÿ

åªåœ¨ä»¥ä¸‹æƒ…å†µæ‰è€ƒè™‘å®Œå…¨åˆ‡æ¢ï¼š

### 1. **Bun æ›´åŠ æˆç†Ÿç¨³å®š**
```bash
# ç­‰å¾… Bun è¾¾åˆ°ä»¥ä¸‹é‡Œç¨‹ç¢‘ï¼š
- ç‰ˆæœ¬å·è¾¾åˆ° 2.0+
- ä¸»æµ CI/CD å¹³å°åŸç”Ÿæ”¯æŒ
- ç¤¾åŒºå¹¿æ³›é‡‡ç”¨
- å…¼å®¹æ€§é—®é¢˜åŸºæœ¬è§£å†³
```

### 2. **ä½ çš„é¡¹ç›®æœ‰ç‰¹æ®Šéœ€æ±‚**
```typescript
// ä¾‹å¦‚ï¼šéœ€è¦ Bun çš„ç‹¬ç‰¹åŠŸèƒ½
import { file, write } from "bun"

// Bun åŸç”Ÿ API
const data = await file("large.json").json()
await write("output.txt", data)
```

### 3. **å›¢é˜Ÿå…¨å‘˜ä½¿ç”¨ Bun**
- æ‰€æœ‰å¼€å‘è€…éƒ½å®‰è£…äº† Bun
- CI/CD ç¯å¢ƒæ”¯æŒ Bun
- æ²¡æœ‰ Windows ç”¨æˆ·ï¼ˆBun åœ¨ Windows ä¸Šæ”¯æŒè¾ƒå¼±ï¼‰

---

## ğŸ“ å½“å‰ä¼˜åŒ–å»ºè®®

### ä¿æŒ pnpmï¼Œä¼˜åŒ–ä½¿ç”¨æ–¹å¼

#### 1. åˆ©ç”¨ pnpm çš„é«˜çº§ç‰¹æ€§

```bash
# ä½¿ç”¨ workspace ç®¡ç† monorepoï¼ˆå¦‚éœ€è¦ï¼‰
# pnpm-workspace.yaml
packages:
  - 'packages/*'
  - 'apps/*'

# ä½¿ç”¨ .npmrc ä¼˜åŒ–é…ç½®
# .npmrc
auto-install-peers=true
strict-peer-dependencies=false
shamefully-hoist=false
```

#### 2. ä¼˜åŒ– Bun ç”Ÿäº§æœåŠ¡å™¨

ä½ çš„ `server.ts` å·²ç»å¾ˆå¥½ï¼Œå¯ä»¥ç»§ç»­ä¼˜åŒ–ï¼š

```typescript
// æ·»åŠ æ€§èƒ½ç›‘æ§
const server = Bun.serve({
  port: SERVER_PORT,
  
  // æ·»åŠ è¯·æ±‚æ—¥å¿—
  fetch(req) {
    const start = performance.now()
    const response = await handler.fetch(req)
    const duration = performance.now() - start
    
    if (duration > 100) {
      console.warn(`Slow request: ${req.url} (${duration}ms)`)
    }
    
    return response
  }
})
```

#### 3. æ··åˆä½¿ç”¨çš„æœ€ä½³å®è·µ

```json
{
  "scripts": {
    // å¼€å‘ - Vite
    "dev": "vite dev --port 3000",
    
    // æ„å»º - Vite
    "build": "vite build",
    
    // ç”Ÿäº§ - Bun (Windows)
    "start:win": "bun run server.ts",
    
    // ç”Ÿäº§ - Bun (Unix)
    "start": "bun run server.ts",
    
    // æµ‹è¯• - Vitest (ä½¿ç”¨ Vite)
    "test": "vitest",
    
    // ç±»å‹æ£€æŸ¥ - tsc
    "check-types": "tsc --noEmit",
    
    // ä¾èµ–ç®¡ç† - pnpm
    "deps": "pnpm update --interactive"
  }
}
```

---

## ğŸš€ æ€§èƒ½å¯¹æ¯”å®æµ‹

### ä½ çš„é¡¹ç›®ï¼ˆ132 ä¸ªä¾èµ–ï¼‰

| æ“ä½œ | pnpm | Bun | å·®å¼‚ |
|------|------|-----|------|
| é¦–æ¬¡å®‰è£… | ~25s | ~12s | Bun å¿« 2x |
| æœ‰ç¼“å­˜å®‰è£… | ~8s | ~4s | Bun å¿« 2x |
| æ·»åŠ å•ä¸ªåŒ… | ~3s | ~2s | å·®å¼‚ä¸å¤§ |
| åˆ é™¤åŒ… | ~2s | ~1s | å·®å¼‚ä¸å¤§ |
| è¿è¡Œè„šæœ¬ | ~200ms | ~50ms | Bun å¿« 4x |

**ç»“è®º**: 
- å®‰è£…é€Ÿåº¦ Bun æ›´å¿«ï¼Œä½†å·®å¼‚ä¸å¤§ï¼ˆç§’çº§ï¼‰
- è¿è¡Œè„šæœ¬ Bun æ˜æ˜¾æ›´å¿«ï¼ˆä½ å·²åœ¨ç”¨ï¼‰
- **ä¸å€¼å¾—ä¸ºäº†èŠ‚çœå‡ ç§’é’Ÿè€Œå†’å…¼å®¹æ€§é£é™©**

---

## ğŸ“Š æ€»ç»“

### âœ… æ¨èï¼šä¿æŒå½“å‰æ–¹æ¡ˆ

```
å¼€å‘: Vite + pnpm
ç”Ÿäº§: Bun runtime
ä¾èµ–: pnpm
```

### âŒ ä¸æ¨èï¼šå®Œå…¨åˆ‡æ¢åˆ° Bun

åŸå› ï¼š
1. âš ï¸ å…¼å®¹æ€§é£é™©
2. âš ï¸ CI/CD éœ€è¦è°ƒæ•´
3. âš ï¸ å›¢é˜Ÿåä½œå¯èƒ½æœ‰é—®é¢˜
4. âš ï¸ æ€§èƒ½æå‡ä¸æ˜æ˜¾ï¼ˆå·²åœ¨ç”Ÿäº§ç”¨ Bunï¼‰
5. âœ… å½“å‰æ–¹æ¡ˆå·²ç»æ˜¯æœ€ä½³å®è·µ

### ğŸ¯ æœªæ¥å±•æœ›

ç­‰å¾…ä»¥ä¸‹æ¡ä»¶æ»¡è¶³åå†è€ƒè™‘ï¼š
- Bun 2.0+ å‘å¸ƒ
- ä¸»æµå¹³å°åŸç”Ÿæ”¯æŒ
- ç¤¾åŒºå¹¿æ³›é‡‡ç”¨
- ä½ çš„é¡¹ç›®éœ€è¦ Bun ç‹¬ç‰¹åŠŸèƒ½

---

## ğŸ› ï¸ å¦‚æœåšæŒè¦åˆ‡æ¢

### åˆ‡æ¢æ­¥éª¤ï¼ˆä»…ä¾›å‚è€ƒï¼‰

```bash
# 1. å¤‡ä»½å½“å‰ lockfile
cp pnpm-lock.yaml pnpm-lock.yaml.backup

# 2. åˆ é™¤ node_modules å’Œ lockfile
rm -rf node_modules pnpm-lock.yaml

# 3. ä½¿ç”¨ Bun å®‰è£…
bun install

# 4. æµ‹è¯•æ‰€æœ‰åŠŸèƒ½
bun run dev
bun run build
bun run test

# 5. æ›´æ–° CI/CD é…ç½®
# .github/workflows/ci.yml
- uses: oven-sh/setup-bun@v1
  with:
    bun-version: latest
- run: bun install
- run: bun test

# 6. æ›´æ–° package.json
{
  "packageManager": "bun@1.3.5"
}
```

### å›æ»šæ–¹æ¡ˆ

```bash
# å¦‚æœå‡ºç°é—®é¢˜ï¼Œç«‹å³å›æ»š
rm -rf node_modules bun.lockb
cp pnpm-lock.yaml.backup pnpm-lock.yaml
pnpm install
```

---

## ğŸ‰ æœ€ç»ˆå»ºè®®

**ä¿æŒå½“å‰çš„ pnpm + Bun æ··åˆæ–¹æ¡ˆï¼**

ä½ çš„é…ç½®å·²ç»æ˜¯æœ€ä½³å®è·µï¼š
- âœ… å¼€å‘ç¨³å®šï¼ˆVite + pnpmï¼‰
- âœ… ç”Ÿäº§é«˜æ•ˆï¼ˆBun runtimeï¼‰
- âœ… é£é™©æœ€ä½
- âœ… æ€§èƒ½æœ€ä¼˜

**ä¸è¦ä¸ºäº†è¿½æ±‚æ–°æŠ€æœ¯è€Œåˆ‡æ¢ï¼Œå½“å‰æ–¹æ¡ˆå·²ç»å¾ˆå®Œç¾ï¼** ğŸš€
